<div class="row">
    <div id="search_tmp" class="col-md-2">
        <select id="host_ids" name="host_ids" class="selectpicker show-tick form-control bs-select-hidden" data-live-search="true">
            {% for info in host_infos %}
                <option value="{{ info.host_id }}">{{ info.remark }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-md-2" hidden>
        <select id="chart_type" name="chart_type" hidden class="selectpicker show-tick form-control bs-select-hidden">
            <option value="0">QPS</option>
            <option value="1">TPS</option>
            <option value="2">QPS</option>
            <option value="3">QPS</option>
            <option value="4">QPS</option>
            <option value="5">QPS</option>
            <option value="6">QPS</option>
        </select>
    </div>
    <div class="col-md-2">
        <button class="btn btn-default" onclick="set_host_id()">Query</button>
        &nbsp;&nbsp;<button class="btn btn-default">Reset</button>
        </br></br>
    </div>
</div>
<div class="row">
    <div id="qps" class="col-md-12" style="height:300px;">
    </div>
</div>
<div class="row">
    <div id="tps" class="col-md-12" style="height:300px;">
    </div>
</div>
<div class="row">
    <div id="thread_chart" class="col-md-12" style="height:300px;">
    </div>
</div>

<script type="text/javascript">
    $('.selectpicker').selectpicker({
        liveSearch: true
    });

    $("#host_ids").find("option:first").attr("selected", true);

    var timer = 0
    var select_host_id = $("#host_ids").val();
    var qps_chart = echarts.init(document.getElementById('qps'));
    var tps_chart = echarts.init(document.getElementById('tps'));
    var thread_chart = echarts.init(document.getElementById('thread_chart'));

    var qps_data_y = [];
    var tps_data_y = [];
    var date_time_x = [];
    var thread_data_y = [];

    function init_chart_data() {
        $("#host_ids option").each(function () {
        })
    }

    function set_host_id() {
        select_host_id = $("#host_ids").val();
        qps_data_y = [];
        tps_data_y = [];
        date_time_x = [];
        thread_data_y = [];
    }

    function set_chart_data(obj_data) {
        qps_data_y.push(obj_data.qps)
        tps_data_y.push(obj_data.tps)
        date_time_x.push(obj_data.time)
        thread_data_y.push(obj_data.threads)
    }

    function get_chart_data() {
        $.get("/chart/" + select_host_id, "", function (data) {
            set_chart_data(jQuery.parseJSON(data))
        });

        refresh_chart(qps_chart, date_time_x, qps_data_y);
        refresh_chart(tps_chart, date_time_x, tps_data_y);
        refresh_chart(thread_chart, date_time_x, thread_data_y)
    }

    function set_chart_options(chart_dom, name, data_x, data_y) {
        var chart_option = {
            title: {
                text: name
            },
            tooltip: {},
            xAxis: {
                data: data_x
            },
            yAxis: {},
            series: [{
                name: name,
                type: 'line',
                data: data_y,
                showSymbol: false,
                hoverAnimation: false,
            }]
        };
        chart_dom.setOption(chart_option)
    }

    function refresh_chart(chart_dom, data_x, data_y) {
        chart_dom.setOption({
            xAxis: {
                data: data_x
            },
            series: [{
                data: data_y
            }]
        });
    }

    set_chart_options(qps_chart, "QPS", date_time_x, qps_data_y);
    set_chart_options(tps_chart, "TPS", date_time_x, tps_data_y);
    set_chart_options(thread_chart, "Threads", date_time_x, thread_data_y);

    get_chart_data();
    clearInterval(timer);
    timer = setInterval(get_chart_data, 2000);
</script>
